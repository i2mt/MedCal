<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>MedCalc Pro | دستیار محاسبات دارویی</title>
    <meta name="description" content="محاسبه گر هوشمند تزریق دارو برای پرستاران و پزشکان">
    <link rel="manifest" href="manifest.json">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@vazirmatn/mathn@latest/dist/Vazirmatn-font-face.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="style.css">
    <style>
@font-face {
    font-family: 'Mitra';
    src: url('fonts/Mitra.eot');
    src: url('fonts/Mitra.eot?#iefix') format('embedded-opentype'),
         url('fonts/Mitra.woff2') format('woff2'),
         url('fonts/Mitra.woff') format('woff'),
         url('fonts/Mitra.ttf') format('truetype');
    font-weight: normal;
    font-style: normal;
    font-display: swap;
}

@font-face {
    font-family: 'Vazirmatn';
    src: url('fonts/Vazirmatn-Regular.woff2') format('woff2');
    font-weight: normal;
    font-style: normal;
    font-display: swap;
}

* {
    font-family: 'Mitra', 'Vazirmatn', Tahoma, Arial, sans-serif;
}

.text-latin {
    font-family: 'Roboto', 'Segoe UI', Arial, sans-serif;
}
    @font-face {
        font-family: 'Mitra';
        src: url('https://cdn.fontcdn.ir/Font/Persian/Mitra/Mitra.eot');
        src: url('https://cdn.fontcdn.ir/Font/Persian/Mitra/Mitra.eot?#iefix') format('embedded-opentype'),
             url('https://cdn.fontcdn.ir/Font/Persian/Mitra/Mitra.woff2') format('woff2'),
             url('https://cdn.fontcdn.ir/Font/Persian/Mitra/Mitra.woff') format('woff'),
             url('https://cdn.fontcdn.ir/Font/Persian/Mitra/Mitra.ttf') format('truetype');
        font-weight: normal;
        font-style: normal;
        font-display: swap;
    }
    
    * {
        font-family: 'Mitra', 'Vazirmatn', -apple-system, BlinkMacSystemFont, sans-serif;
    }
    
    .text-latin {
        font-family: 'Roboto', 'Roboto Mono', 'Courier New', monospace;
    }
    
    /* Large font setting */
    .large-font {
        font-size: 18px;
    }
    
    .large-font .drug-name-compact,
    .large-font .selected-drug-name-compact,
    .large-font .result-value-enhanced,
    .large-font .dose-input-wrapper input {
        font-size: 1.2em;
    }
    
    .large-font .drug-name-english,
    .large-font .selected-drug-desc-compact,
    .large-font .result-label-enhanced,
    .large-font .result-unit-enhanced {
        font-size: 0.9em;
    }
    
    /* ============================================
       COMPLETE REMOVAL OF QUICK ACTIONS - ABSOLUTE
       ============================================ */
    .quick-actions-enhanced,
    .quick-actions,
    .action-btn-enhanced,
    .action-btn,
    #saveCalculation,
    #shareCalculation,
    #resetCalculator,
    #manualResetBtn,
    #closeManualBtn2,
    .quick-actions-enhanced *,
    .quick-actions * {
        display: none !important;
        visibility: hidden !important;
        opacity: 0 !important;
        height: 0 !important;
        width: 0 !important;
        padding: 0 !important;
        margin: 0 !important;
        border: none !important;
        position: absolute !important;
        left: -9999px !important;
        pointer-events: none !important;
    }
    
    /* ===============================
       FIX METHOD BUTTON TEXT COLOR
       =============================== */
    .method-btn-compact.active {
        background: var(--gradient-primary) !important;
        border-color: transparent !important;
        color: white !important;
        box-shadow: 0 6px 20px rgba(102, 126, 234, 0.4) !important;
        transform: translateY(-2px);
        font-weight: 700;
    }
    
    .method-btn-compact.active i,
    .method-btn-compact.active span {
        color: white !important;
    }
    
    .dark-mode .method-btn-compact.active {
        background: var(--gradient-primary) !important;
        color: white !important;
    }
    
    .dark-mode .method-btn-compact.active i,
    .dark-mode .method-btn-compact.active span {
        color: white !important;
    }
    
    /* ===============================
       FIX VOLUME BUTTONS TEXT COLOR
       =============================== */
    .volume-preset-btn.active {
        background: var(--gradient-primary) !important;
        border-color: transparent !important;
        color: white !important;
        box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3) !important;
    }
    
    .volume-preset-btn.active .number,
    .volume-preset-btn.active .unit-text,
    .volume-preset-btn.active .custom-text {
        color: white !important;
    }
    
    .dark-mode .volume-preset-btn.active {
        background: var(--gradient-primary) !important;
        color: white !important;
        border-color: transparent !important;
    }
    
    .dark-mode .volume-preset-btn.active .number,
    .dark-mode .volume-preset-btn.active .unit-text,
    .dark-mode .volume-preset-btn.active .custom-text {
        color: white !important;
    }
    
    /* ===============================
       MOBILE FIXES
       =============================== */
    @media (max-width: 768px) {
        /* Drug Sidebar - Fixed height */
        .drug-sidebar {
            flex: 0 0 160px !important;
            height: 160px !important;
            min-height: 160px !important;
            max-height: 160px !important;
            padding: 0 !important;
            margin: 0 !important;
            background: var(--surface) !important;
            border-bottom: 1px solid var(--border) !important;
            border-radius: 0 !important;
            display: flex !important;
            flex-direction: column !important;
            overflow: visible !important;
            z-index: 50 !important;
        }
        
        .drug-quick-select {
            display: flex !important;
            flex-direction: column !important;
            height: 100% !important;
            width: 100% !important;
            padding: 8px !important;
            gap: 8px !important;
        }
        
        .drug-quick-select h3 {
            display: none !important;
        }
        
        /* Drug search */
        .drug-search-container {
            flex-shrink: 0 !important;
            height: 36px !important;
            margin: 0 !important;
            position: relative !important;
        }
        
        .drug-search-container input {
            width: 100% !important;
            height: 36px !important;
            padding: 0 36px 0 12px !important;
            font-size: 14px !important;
            border-radius: 8px !important;
            border: 2px solid var(--border) !important;
            background: var(--surface-elevated) !important;
        }
        
        /* Drug scroll container */
        .drug-scroll-container {
            flex: 1 !important;
            min-height: 0 !important;
            overflow-x: auto !important;
            overflow-y: hidden !important;
            -webkit-overflow-scrolling: touch !important;
            padding: 4px 0 !important;
            margin: 0 -4px !important;
        }
        
        /* Drug grid */
        .drug-grid-compact {
            display: flex !important;
            flex-direction: row !important;
            gap: 8px !important;
            padding: 0 4px !important;
            height: 100% !important;
            align-items: center !important;
            flex-wrap: nowrap !important;
            min-width: min-content !important;
        }
        
        /* Drug items */
        .drug-item-compact {
            flex: 0 0 90px !important;
            width: 90px !important;
            height: 90px !important;
            padding: 10px 6px !important;
            margin: 0 !important;
            border-radius: 10px !important;
            background: var(--surface-elevated) !important;
            border: 2px solid var(--border) !important;
            cursor: pointer !important;
            display: flex !important;
            flex-direction: column !important;
            align-items: center !important;
            justify-content: center !important;
            transition: all 0.2s ease !important;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05) !important;
            position: relative !important;
        }
        
        .drug-icon-small {
            width: 32px !important;
            height: 32px !important;
            border-radius: 8px !important;
            font-size: 16px !important;
            margin-bottom: 6px !important;
        }
        
        .drug-name-compact {
            font-size: 11px !important;
            font-weight: 700 !important;
            line-height: 1.2 !important;
            margin-bottom: 2px !important;
        }
        
        .drug-name-english {
            font-size: 9px !important;
        }
        
        /* MANUAL CALCULATION BUTTON - SAME SIZE AS DRUG ITEMS */
        #openManualMobile {
            flex: 0 0 90px !important;
            width: 90px !important;
            height: 90px !important;
            padding: 10px 6px !important;
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%) !important;
            color: white !important;
            border: none !important;
            border-radius: 10px !important;
            display: flex !important;
            flex-direction: column !important;
            align-items: center !important;
            justify-content: center !important;
            gap: 4px !important;
            font-size: 11px !important;
            font-weight: 700 !important;
            cursor: pointer !important;
            box-shadow: 0 2px 4px rgba(240, 147, 251, 0.3) !important;
            transition: all 0.2s ease !important;
            order: 9999 !important;
        }
        
        #openManualMobile i {
            font-size: 18px !important;
            color: white !important;
            margin-bottom: 4px !important;
        }
        
        #openManualMobile span {
            font-size: 11px !important;
            font-weight: 700 !important;
            text-align: center;
            line-height: 1.2;
            color: white !important;
        }
        
        /* Hide desktop manual button in mobile */
        #openManual {
            display: none !important;
        }
        
        /* COMPLETE REMOVAL OF QUICK ACTIONS IN MOBILE */
        .quick-actions-enhanced,
        .quick-actions,
        .action-btn-enhanced,
        .action-btn,
        #saveCalculation,
        #shareCalculation,
        #resetCalculator,
        #manualResetBtn,
        #closeManualBtn2 {
            display: none !important;
            visibility: hidden !important;
            opacity: 0 !important;
            height: 0 !important;
            width: 0 !important;
            padding: 0 !important;
            margin: 0 !important;
            position: absolute !important;
            left: -9999px !important;
        }
    }
</style>
</head>
<body>
    <!-- Header -->
    <header class="app-header">
        <div class="header-content">
            <div class="logo-section">
                <div class="logo">
                    <i class="fas fa-syringe"></i>
                </div>
                <div class="logo-text">
                    <h1>MedCalc Pro</h1>
                    <p>دستیار هوشمند محاسبات انفوزیون</p>
                </div>
            </div>
            <div class="header-actions">
                <!-- Desktop actions -->
                <button class="icon-btn" id="themeToggle">
                    <i class="fas fa-moon"></i>
                </button>
                <button class="icon-btn" id="historyBtn">
                    <i class="fas fa-history"></i>
                </button>
                <button class="icon-btn" id="settingsBtn">
                    <i class="fas fa-cog"></i>
                </button>
            </div>
        </div>
    </header>

    <!-- Main App Container -->
    <div class="app-container">
        <!-- Main Content -->
        <div class="main-content">
            <!-- Calculator Tab -->
            <div class="tab-pane active" id="calculatorTab">
                <div class="calculator-layout">
                    <!-- Left: Drug Selection -->
                    <div class="drug-sidebar">
                        <div class="drug-quick-select">
                            <h3><i class="fas fa-search"></i> انتخاب سریع دارو</h3>
                            <div class="drug-search-container">
                                <input type="text" id="drugSearch" placeholder="جستجوی دارو..." autocomplete="off">
                                <i class="fas fa-search"></i>
                            </div>
                            <div class="drug-scroll-container">
                                <div class="drug-grid-compact" id="drugGrid">
                                    <!-- Drug cards will be loaded here by JavaScript -->
                                </div>
                            </div>
                            <button class="manual-entry-btn gradient" id="openManual">
                                <i class="fas fa-edit"></i>
                                <span>محاسبه دستی داروی دیگر</span>
                            </button>
                        </div>
                    </div>

                    <!-- Right: Calculator Main Area -->
                    <div class="calculator-main">
                        <!-- Selected Drug Header -->
                        <div class="selected-drug-compact">
                            <div class="selected-drug-icon-compact" id="selectedDrugIcon">
                                <i class="fas fa-pills"></i>
                            </div>
                            <div class="selected-drug-info-compact">
                                <div class="selected-drug-name-compact" id="selectedDrugName">هپارین</div>
                                <div class="selected-drug-desc-compact" id="selectedDrugDesc">
                                    <span class="text-latin">Heparin</span>
                                    <span class="text-mixed"> - </span>
                                    <span class="text-latin">Anticoagulant</span>
                                </div>
                            </div>
                        </div>

                        <!-- Manual Calculation Section -->
                        <div class="manual-calculation-section" id="manualSection" style="display: none;">
                            <!-- Content will be loaded dynamically by JavaScript -->
                        </div>

                        <!-- Calculator Controls -->
                        <div class="calculator-controls-grid" id="calculatorControls">
                            <!-- Method -->
                            <div class="control-group">
                                <label><i class="fas fa-infinity"></i> روش تزریق</label>
                                <div class="method-selector-compact">
                                    <button class="method-btn-compact gradient active" data-method="syringe">
                                        <i class="fas fa-syringe"></i> پمپ سرنگ
                                    </button>
                                    <button class="method-btn-compact gradient" data-method="infusion">
                                        <i class="fas fa-pump-medical"></i> پمپ انفوزیون
                                    </button>
                                </div>
                            </div>

                            <!-- Volume -->
                            <div class="control-group">
                                <label><i class="fas fa-flask"></i> حجم محلول</label>
                                <div class="volume-selector-enhanced">
                                    <div class="volume-presets" id="volumeOptions"></div>
                                    <div class="volume-custom-input" id="customVolumeContainer" style="display: none;">
                                        <input type="number" id="customVolume" placeholder="حجم دلخواه" min="1" max="5000">
                                        <span class="text-mixed">سی‌سی</span>
                                    </div>
                                </div>
                            </div>

                            <!-- Ampoules with Button Selector -->
                            <div class="control-group">
                                <label><i class="fas fa-syringe"></i> تعداد آمپول</label>
                                <div class="ampoule-control-enhanced">
                                    <button class="ampoule-btn-enhanced gradient" id="decreaseAmpoule">
                                        <i class="fas fa-minus"></i>
                                    </button>
                                    <div class="ampoule-count-enhanced">
                                        <span id="ampouleCount">2</span>
                                        <small>عدد</small>
                                    </div>
                                    <button class="ampoule-btn-enhanced gradient" id="increaseAmpoule">
                                        <i class="fas fa-plus"></i>
                                    </button>
                                </div>
                                <div class="ampoule-info-enhanced" id="ampouleInfo">
                                    <span class="text-mixed">هر آمپول:</span>
                                    <span class="text-latin">5000 units in 1 ml</span>
                                </div>
                                <!-- Ampoule Type Buttons -->
                                <div class="ampoule-type-buttons" id="ampouleTypeButtons" style="display: none; margin-top: 10px;">
                                    <!-- Will be populated dynamically -->
                                </div>
                            </div>

                            <!-- Desired Dose -->
                            <div class="control-group">
                                <label><i class="fas fa-file-medical-alt"></i> دوز درخواستی</label>
                                <div class="dose-input-enhanced">
                                    <div class="dose-input-wrapper">
                                        <input type="number" id="doctorOrder" placeholder="0" min="0" step="0.1">
                                        <span class="dose-unit-enhanced" id="orderUnit">units/hour</span>
                                    </div>
                                </div>
                                <!-- Weight Toggle -->
                                <div class="weight-toggle-enhanced" id="weightContainer" style="display: none;">
                                    <div class="toggle-section">
                                        <label class="toggle-switch-enhanced" aria-label="محاسبه بر اساس وزن">
                                            <input type="checkbox" id="weightCheckbox">
                                            <span class="toggle-slider-enhanced"></span>
                                        </label>
                                        <label class="toggle-label" for="weightCheckbox">
                                            <i class="fas fa-weight-scale"></i>
                                            <span>محاسبه بر اساس وزن</span>
                                        </label>
                                    </div>
                                    <div class="weight-input-section">
                                        <input type="number" id="patientWeight" placeholder="0" min="0" step="0.1" inputmode="decimal" disabled>
                                        <span class="weight-unit text-latin">kg</span>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Calculate Button -->
                        <button class="calculate-btn-enhanced gradient" id="calculateBtn">
                            <i class="fas fa-calculator"></i>
                            <span>محاسبه سرعت پمپ</span>
                        </button>

                        <!-- Results -->
                        <div class="results-section-enhanced" id="resultsSection" style="display: none;">
                            <h3><i class="fas fa-chart-line"></i> نتایج محاسبه</h3>
                            <div class="results-grid-enhanced">
                                <div class="result-item-enhanced">
                                    <div class="result-label-enhanced">مقدار کل دارو</div>
                                    <div class="result-value-enhanced" id="totalDrugAmount">0</div>
                                    <div class="result-unit-enhanced" id="totalDrugUnit">واحد</div>
                                </div>
                                <div class="result-item-enhanced">
                                    <div class="result-label-enhanced">غلظت محلول</div>
                                    <div class="result-value-enhanced" id="concentrationResult">0</div>
                                    <div class="result-unit-enhanced" id="concentrationUnit">واحد/سی‌سی</div>
                                </div>
                                <div class="result-item-enhanced highlight gradient">
                                    <div class="result-label-enhanced">سرعت پمپ</div>
                                    <div class="result-value-enhanced" id="pumpRateResult">0</div>
                                    <div class="result-unit-enhanced" id="pumpRateUnit">سی‌سی/ساعت</div>
                                </div>
                                <div class="result-item-enhanced">
                                    <div class="result-label-enhanced">زمان تخمینی</div>
                                    <div class="result-value-enhanced" id="durationResult">0</div>
                                    <div class="result-unit-enhanced" id="durationUnit">ساعت</div>
                                </div>
                            </div>
                        </div>

                        <!-- Step-by-Step Guide -->
                        <div class="guide-section" id="guideSection" style="display: none;">
                            <div class="guide-header">
                                <i class="fas fa-list-ol"></i>
                                <span>راهنمای آماده‌سازی و تزریق</span>
                            </div>
                            <div class="guide-steps" id="stepByStepGuide"></div>
                        </div>

                        <!-- Warnings -->
                        <div class="warnings-section" id="warningsSection" style="display: none;">
                            <div class="warnings-header">
                                <i class="fas fa-exclamation-triangle"></i>
                                <span>هشدارها و نکات مهم</span>
                            </div>
                            <div class="warnings-list" id="warningsList"></div>
                        </div>

                        <!-- Compatibility -->
                        <div class="compatibility-section" id="compatibilitySection" style="display: none;">
                            <div class="compatibility-header">
                                <i class="fas fa-exchange-alt"></i>
                                <span>سازگاری Y-Site</span>
                            </div>
                            <div class="compatibility-grid">
                                <div class="compatible-drugs">
                                    <div class="compatibility-title">
                                        <i class="fas fa-check-circle"></i>
                                        <span>سازگار</span>
                                    </div>
                                    <div class="compatibility-list" id="compatibleDrugsList"></div>
                                </div>
                                <div class="incompatible-drugs">
                                    <div class="compatibility-title">
                                        <i class="fas fa-times-circle"></i>
                                        <span>ناسازگار</span>
                                    </div>
                                    <div class="compatibility-list" id="incompatibleDrugsList"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Converters Tab -->
            <div class="tab-pane" id="convertersTab">
                <div class="converters-container">
                    <h2><i class="fas fa-exchange-alt"></i> مبدل‌های دارویی</h2>
                    
                    <div class="converter-grid">
                        <!-- Electrolyte Converter -->
                        <div class="converter-card gradient">
                            <div class="converter-header">
                                <i class="fas fa-bolt"></i>
                                <h3>مبدل الکترولیت</h3>
                            </div>
                            <div class="converter-body">
                                <div class="input-group">
                                    <label>عنصر:</label>
                                    <select id="electrolyteElement">
                                        <option value="sodium">سدیم (Na)</option>
                                        <option value="potassium">پتاسیم (K)</option>
                                        <option value="calcium">کلسیم (Ca)</option>
                                        <option value="magnesium">منیزیم (Mg)</option>
                                    </select>
                                </div>
                                <div class="input-group">
                                    <label>مقدار:</label>
                                    <input type="number" id="electrolyteValue" placeholder="0" step="0.1">
                                    <select id="electrolyteFrom">
                                        <option value="mEq">mEq</option>
                                        <option value="mg">میلی‌گرم</option>
                                    </select>
                                </div>
                                <button class="converter-btn gradient" onclick="convertElectrolyte()">
                                    <i class="fas fa-sync-alt"></i> تبدیل
                                </button>
                                <div class="converter-result" id="electrolyteResult">
                                    نتیجه محاسبه
                                </div>
                            </div>
                        </div>

                        <!-- Percentage Converter -->
                        <div class="converter-card gradient">
                            <div class="converter-header">
                                <i class="fas fa-percentage"></i>
                                <h3>مبدل درصدی</h3>
                            </div>
                            <div class="converter-body">
                                <div class="input-group">
                                    <label>درصد محلول:</label>
                                    <input type="number" id="percentageValue" placeholder="0" step="0.1">
                                </div>
                                <div class="input-group">
                                    <label>حجم (میلی‌لیتر):</label>
                                    <input type="number" id="percentageVolume" value="100" step="1">
                                </div>
                                <button class="converter-btn gradient" onclick="convertPercentage()">
                                    <i class="fas fa-sync-alt"></i> تبدیل
                                </button>
                                <div class="converter-result" id="percentageResult">
                                    نتیجه محاسبه
                                </div>
                            </div>
                        </div>

                        <!-- Unit Converter -->
                        <div class="converter-card gradient">
                            <div class="converter-header">
                                <i class="fas fa-balance-scale"></i>
                                <h3>مبدل واحد</h3>
                            </div>
                            <div class="converter-body">
                                <div class="input-group">
                                    <label>از واحد:</label>
                                    <select id="unitFrom">
                                        <option value="mcg">میکروگرم (mcg)</option>
                                        <option value="mg">میلی‌گرم (mg)</option>
                                        <option value="g">گرم (g)</option>
                                        <option value="units">واحد (units)</option>
                                    </select>
                                </div>
                                <div class="input-group">
                                    <label>به واحد:</label>
                                    <select id="unitTo">
                                        <option value="mg">میلی‌گرم (mg)</option>
                                        <option value="mcg">میکروگرم (mcg)</option>
                                        <option value="g">گرم (g)</option>
                                        <option value="units">واحد (units)</option>
                                    </select>
                                </div>
                                <div class="input-group">
                                    <label>مقدار:</label>
                                    <input type="number" id="unitValue" placeholder="0" step="0.01">
                                </div>
                                <button class="converter-btn gradient" onclick="convertUnits()">
                                    <i class="fas fa-sync-alt"></i> تبدیل
                                </button>
                                <div class="converter-result" id="unitResult">
                                    نتیجه محاسبه
                                </div>
                            </div>
                        </div>

                        <!-- Drip Rate Calculator -->
                        <div class="converter-card gradient">
                            <div class="converter-header">
                                <i class="fas fa-tint"></i>
                                <h3>ماشین حساب دراپ</h3>
                            </div>
                            <div class="converter-body">
                                <div class="input-group">
                                    <label>حجم (میلی‌لیتر):</label>
                                    <input type="number" id="dripVolume" placeholder="0" step="1">
                                </div>
                                <div class="input-group">
                                    <label>زمان (ساعت):</label>
                                    <input type="number" id="dripTime" placeholder="0" step="0.1">
                                </div>
                                <div class="input-group">
                                    <label>فاکتور قطره:</label>
                                    <select id="dripFactor">
                                        <option value="10">10 قطره/میلی‌لیتر (ماکرو)</option>
                                        <option value="15">15 قطره/میلی‌لیتر</option>
                                        <option value="20">20 قطره/میلی‌لیتر (مایکرو)</option>
                                        <option value="60">60 قطره/میلی‌لیتر (میکروست)</option>
                                    </select>
                                </div>
                                <button class="converter-btn gradient" onclick="calculateDripRate()">
                                    <i class="fas fa-calculator"></i> محاسبه
                                </button>
                                <div class="converter-result" id="dripResult">
                                    نتیجه محاسبه
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Drugs Tab -->
            <div class="tab-pane" id="drugsTab">
                <div class="drugs-container">
                    <h2><i class="fas fa-pills"></i> بانک اطلاعات دارویی</h2>
                    
                    <div class="drugs-search">
                        <input type="text" id="librarySearch" placeholder="جستجوی دارو در بانک اطلاعات...">
                        <i class="fas fa-search"></i>
                    </div>
                    
                    <div class="drugs-library" id="drugLibrary">
                        <!-- Drug cards will be loaded here by JavaScript -->
                    </div>
                </div>
            </div>

            <!-- Tools Tab -->
            <div class="tab-pane" id="toolsTab">
                <div class="tools-container">
                    <h2><i class="fas fa-tools"></i> ابزارهای جانبی</h2>
                    
                    <div class="tools-grid">
                        <!-- BMI Calculator -->
                        <div class="tool-card gradient">
                            <div class="tool-header">
                                <i class="fas fa-weight-scale"></i>
                                <h3>ماشین حساب BMI</h3>
                            </div>
                            <div class="tool-body">
                                <div class="input-group">
                                    <label>وزن (کیلوگرم):</label>
                                    <input type="number" id="bmiWeight" placeholder="0" step="0.1">
                                </div>
                                <div class="input-group">
                                    <label>قد (سانتی‌متر):</label>
                                    <input type="number" id="bmiHeight" placeholder="0" step="0.1">
                                </div>
                                <button class="tool-btn gradient" onclick="calculateBMI()">
                                    <i class="fas fa-calculator"></i> محاسبه BMI
                                </button>
                                <div class="tool-result" id="bmiResult">
                                    نتیجه محاسبه
                                </div>
                            </div>
                        </div>

                        <!-- Body Surface Area -->
                        <div class="tool-card gradient">
                            <div class="tool-header">
                                <i class="fas fa-ruler-combined"></i>
                                <h3>سطح بدن (BSA)</h3>
                            </div>
                            <div class="tool-body">
                                <div class="input-group">
                                    <label>وزن (کیلوگرم):</label>
                                    <input type="number" id="bsaWeight" placeholder="0" step="0.1">
                                </div>
                                <div class="input-group">
                                    <label>قد (سانتی‌متر):</label>
                                    <input type="number" id="bsaHeight" placeholder="0" step="0.1">
                                </div>
                                <div class="input-group">
                                    <label>فرمول:</label>
                                    <select id="bsaFormula">
                                        <option value="mosteller">Mosteller</option>
                                        <option value="dubois">DuBois</option>
                                        <option value="haycock">Haycock</option>
                                    </select>
                                </div>
                                <button class="tool-btn gradient" onclick="calculateBSA()">
                                    <i class="fas fa-calculator"></i> محاسبه BSA
                                </button>
                                <div class="tool-result" id="bsaResult">
                                    نتیجه محاسبه
                                </div>
                            </div>
                        </div>

                        <!-- Ideal Body Weight -->
                        <div class="tool-card gradient">
                            <div class="tool-header">
                                <i class="fas fa-user-md"></i>
                                <h3>وزن ایده‌آل بدن</h3>
                            </div>
                            <div class="tool-body">
                                <div class="input-group">
                                    <label>قد (سانتی‌متر):</label>
                                    <input type="number" id="ibwHeight" placeholder="0" step="0.1">
                                </div>
                                <div class="input-group">
                                    <label>جنسیت:</label>
                                    <select id="ibwGender">
                                        <option value="male">مرد</option>
                                        <option value="female">زن</option>
                                    </select>
                                </div>
                                <div class="input-group">
                                    <label>فرمول:</label>
                                    <select id="ibwFormula">
                                        <option value="devine">Devine</option>
                                        <option value="robinson">Robinson</option>
                                        <option value="miller">Miller</option>
                                    </select>
                                </div>
                                <button class="tool-btn gradient" onclick="calculateIBW()">
                                    <i class="fas fa-calculator"></i> محاسبه وزن ایده‌آل
                                </button>
                                <div class="tool-result" id="ibwResult">
                                    نتیجه محاسبه
                                </div>
                            </div>
                        </div>

                        <!-- Creatinine Clearance -->
                        <div class="tool-card gradient">
                            <div class="tool-header">
                                <i class="fas fa-kidneys"></i>
                                <h3>کلیرانس کراتینین</h3>
                            </div>
                            <div class="tool-body">
                                <div class="input-group">
                                    <label>سن (سال):</label>
                                    <input type="number" id="crclAge" placeholder="0" step="1">
                                </div>
                                <div class="input-group">
                                    <label>وزن (کیلوگرم):</label>
                                    <input type="number" id="crclWeight" placeholder="0" step="0.1">
                                </div>
                                <div class="input-group">
                                    <label>کراتینین (mg/dL):</label>
                                    <input type="number" id="crclValue" placeholder="0" step="0.01">
                                </div>
                                <div class="input-group">
                                    <label>جنسیت:</label>
                                    <select id="crclGender">
                                        <option value="male">مرد</option>
                                        <option value="female">زن</option>
                                    </select>
                                </div>
                                <button class="tool-btn gradient" onclick="calculateCrCl()">
                                    <i class="fas fa-calculator"></i> محاسبه CrCl
                                </button>
                                <div class="tool-result" id="crclResult">
                                    نتیجه محاسبه
                                </div>
                            </div>
                        </div>

                        <!-- Compatibility Checker -->
                        <div class="tool-card gradient">
                            <div class="tool-header">
                                <i class="fas fa-check-double"></i>
                                <h3>بررسی سازگاری</h3>
                            </div>
                            <div class="tool-body">
                                <div class="input-group">
                                    <label>داروی اول:</label>
                                    <select id="compatDrug1">
                                        <option value="">انتخاب دارو</option>
                                    </select>
                                </div>
                                <div class="input-group">
                                    <label>داروی دوم:</label>
                                    <select id="compatDrug2">
                                        <option value="">انتخاب دارو</option>
                                    </select>
                                </div>
                                <div class="input-group">
                                    <label>محلول:</label>
                                    <select id="compatSolution">
                                        <option value="NS">N/S</option>
                                        <option value="D5W">D5W</option>
                                        <option value="DS">D/S</option>
                                        <option value="RL">Ringer Lactate</option>
                                    </select>
                                </div>
                                <button class="tool-btn gradient" onclick="checkCompatibility()">
                                    <i class="fas fa-search"></i> بررسی سازگاری
                                </button>
                                <div class="tool-result" id="compatResult">
                                    نتیجه بررسی
                                </div>
                            </div>
                        </div>

                        <!-- Dose Calculator -->
                        <div class="tool-card gradient">
                            <div class="tool-header">
                                <i class="fas fa-capsules"></i>
                                <h3>ماشین حساب دوز</h3>
                            </div>
                            <div class="tool-body">
                                <div class="input-group">
                                    <label>دوز مورد نیاز (mg):</label>
                                    <input type="number" id="doseNeeded" placeholder="0" step="0.1">
                                </div>
                                <div class="input-group">
                                    <label>غلظت موجود (mg/ml):</label>
                                    <input type="number" id="doseConcentration" placeholder="0" step="0.01">
                                </div>
                                <div class="input-group">
                                    <label>حجم ویال (ml):</label>
                                    <input type="number" id="doseVialVolume" placeholder="0" step="0.1">
                                </div>
                                <button class="tool-btn gradient" onclick="calculateDose()">
                                    <i class="fas fa-calculator"></i> محاسبه حجم
                                </button>
                                <div class="tool-result" id="doseResult">
                                    نتیجه محاسبه
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Bottom Tab Navigation -->
        <div class="tab-bar">
            <button class="tab-item active" data-tab="calculator">
                <i class="fas fa-calculator"></i>
                <span>محاسبه</span>
            </button>
            <button class="tab-item" data-tab="converters">
                <i class="fas fa-exchange-alt"></i>
                <span>مبدل‌ها</span>
            </button>
            <button class="tab-item" data-tab="drugs">
                <i class="fas fa-pills"></i>
                <span>داروها</span>
            </button>
            <button class="tab-item" data-tab="tools">
                <i class="fas fa-tools"></i>
                <span>ابزارها</span>
            </button>
        </div>
    </div>

    <!-- Settings Modal -->
    <div class="modal" id="settingsModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3><i class="fas fa-cog"></i> تنظیمات</h3>
                <button class="modal-close" id="closeSettings">&times;</button>
            </div>
            <div class="modal-body">
                <div class="settings-group">
                    <h4><i class="fas fa-palette"></i> تنظیمات ظاهری</h4>
                    <div class="setting-item">
                        <span>حالت تاریک</span>
                        <label class="switch">
                            <input type="checkbox" id="darkModeToggle">
                            <span class="slider"></span>
                        </label>
                    </div>
                    <div class="setting-item">
                        <span>فونت بزرگ</span>
                        <label class="switch">
                            <input type="checkbox" id="largeFontToggle">
                            <span class="slider"></span>
                        </label>
                    </div>
                </div>
                
                <div class="settings-group">
                    <h4><i class="fas fa-bell"></i> اعلان‌ها</h4>
                    <div class="setting-item">
                        <span>هشدار دوز</span>
                        <label class="switch">
                            <input type="checkbox" id="doseAlertToggle" checked>
                            <span class="slider"></span>
                        </label>
                    </div>
                    <div class="setting-item">
                        <span>هشدار سازگاری</span>
                        <label class="switch">
                            <input type="checkbox" id="compatAlertToggle" checked>
                            <span class="slider"></span>
                        </label>
                    </div>
                </div>
                
                <div class="settings-group">
                    <h4><i class="fas fa-database"></i> داده‌ها</h4>
                    <div class="setting-item">
                        <span>ذخیره تاریخچه</span>
                        <label class="switch">
                            <input type="checkbox" id="saveHistoryToggle" checked>
                            <span class="slider"></span>
                        </label>
                    </div>
                    <button class="setting-btn gradient" id="clearHistoryBtn">
                        <i class="fas fa-trash"></i> پاک کردن تاریخچه
                    </button>
                    <button class="setting-btn gradient" id="exportDataBtn">
                        <i class="fas fa-download"></i> خروجی گرفتن
                    </button>
                </div>
                
                <div class="settings-group">
                    <h4><i class="fas fa-info-circle"></i> درباره</h4>
                    <div class="about-info">
                        <p><strong>نسخه:</strong> 2.0.1</p>
                        <p><strong>تعداد داروها:</strong> <span id="drugCount">11</span></p>
                        <p><strong>آخرین به‌روزرسانی:</strong> <span id="lastUpdate">1402/10/15</span></p>
                    </div>
                    <button class="setting-btn gradient" id="checkUpdateBtn">
                        <i class="fas fa-sync-alt"></i> بررسی به‌روزرسانی
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- History Modal -->
    <div class="modal" id="historyModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3><i class="fas fa-history"></i> تاریخچه محاسبات</h3>
                <button class="modal-close" id="closeHistory">&times;</button>
            </div>
            <div class="modal-body">
                <div class="history-list" id="historyList">
                    <!-- History items will be loaded here by JavaScript -->
                </div>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="drugDatabase.js"></script>
    <script src="converters.js"></script>
    <script src="script.js"></script>
    
    <!-- PWA Registration -->
    <script>
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('service-worker.js');
            });
        }
    </script>
</body>
</html>